!function e(t,s,r){function i(n,o){if(!s[n]){if(!t[n]){var p="function"==typeof require&&require;if(!o&&p)return p(n,!0);if(a)return a(n,!0);throw new Error("Cannot find module '"+n+"'")}var u=s[n]={exports:{}};t[n][0].call(u.exports,function(e){var s=t[n][1][e];return i(s?s:e)},u,u.exports,e,t,s,r)}return s[n].exports}for(var a="function"==typeof require&&require,n=0;n<r.length;n++)i(r[n]);return i}({1:[function(e,t,s){"use strict";var r=e("rasm-asm"),i=e("./pretty-byte.js"),a=e("rasm-vm"),n=e("./ui.js"),o=new a;window.runtime=o,o.events.on("updateInstructionPointer",function(e){n.ip.innerHTML=i(e);var t=document.querySelector(".js-ip-focus");null!==t&&(t.className=""),n.ramCells[e].className="ip-focus js-ip-focus"}),o.events.on("updateStackPointer",function(e){n.sp.innerHTML=i(e);var t=document.querySelector(".js-sp-focus");null!==t&&(t.className=""),n.ramCells[e].className="sp-focus js-sp-focus"}),o.events.on("updateCBit",function(e){n.cBit.innerHTML=String(e)}),o.events.on("updateZBit",function(e){n.zBit.innerHTML=String(e)});for(var p=0;4>p;p++)o.events.on("updateRegister:"+String(p),function(e,t){n.registers[e].innerHTML=i(t)});for(var p=0;256>p;p++)o.events.on("updateRam:"+String(p),function(e,t){n.ramCells[e].innerHTML=i(t)});o.reset(),n.assemble.addEventListener("click",function(){o.reset();try{r(n.code.value).forEach(function(e,t){o.writeRam(t,e)})}catch(e){console.log("Assembler error:\n"+e.message)}}),n.step.addEventListener("click",function(){o.step()});var u=!1;n.runStop.addEventListener("click",function(){function e(){u&&(o.step(),o.halted&&(u=!1,n.runStop.innerHTML="Run"),setTimeout(e,250))}u?(u=!1,n.runStop.innerHTML="Run"):(u=!0,n.runStop.innerHTML="Stop",e())})},{"./pretty-byte.js":2,"./ui.js":3,"rasm-asm":4,"rasm-vm":12}],2:[function(e,t,s){"use strict";t.exports=function(e){return("0"+e.toString(16)).slice(-2)}},{}],3:[function(e,t,s){"use strict";var r=document.querySelector.bind(document),i={assemble:r(".js-assemble"),runStop:r(".js-run-stop"),step:r(".js-step"),reset:r(".js-reset"),code:r(".js-code"),registers:[r(".js-r0"),r(".js-r1"),r(".js-r2"),r(".js-r3")],ip:r(".js-ip"),sp:r(".js-sp"),cBit:r(".js-c-bit"),zBit:r(".js-z-bit"),ramCells:document.querySelectorAll(".js-ram-cells td")};t.exports=i},{}],4:[function(e,t,s){"use strict";var r=e("./error-at-line.js"),i=e("./mappings.js"),a=e("./operand-type.js"),n=e("./operand-value.js"),o={register:0,constant:1,address:2,relative:3};t.exports=function(e){var t=e.split("\n").map(function(e,t){return{text:e.split(";")[0].trim(),number:t}}).filter(function(e){return""!==e.text}),s=[],p={},u=[];return t.forEach(function(e){var t,c,l,h,g,v=e.text;if(":"===v[v.length-1])p[v.slice(0,-1)]=s.length;else switch(t=v.split(" "),c=t[0],l=t.slice(1),h=0,g=0,c){case".num":s.push(n(l[0]));break;case".str":l.join(" ").split("").forEach(function(e){s.push(e.charCodeAt(0))});break;default:if(!i.hasOwnProperty(c))throw new Error("Unknown instruction: "+c+r(e));if(l.length!==i[c].params.length)throw new Error("Wrong number of parameters for "+c+" ("+String(l.length)+" instead of "+String(i[c].params.length)+")");h|=i[c].base,l.forEach(function(e,t){var r,p,l=i[c].params[t],v=a(e);if("label"===v)u.push({address:s.length+1,"with":e}),r=o.constant;else{if(p=n(e),r=o[v],-1===l.types.indexOf(v))throw new Error("Illegal type for parameter "+String(t+1)+" of "+c+" (must be one of: "+l.types.join(", ")+")");l.valueTo[0]>7?h|=p<<l.valueTo[0]%8:g|=p<<l.valueTo[0]}null!==l.typeTo&&(l.typeTo[0]>7?h|=r<<l.typeTo[0]%8:g|=r<<l.typeTo[0])}),s.push(h,g)}}),u.forEach(function(e){s[e.address]=p[e["with"]]}),s}},{"./error-at-line.js":5,"./mappings.js":6,"./operand-type.js":7,"./operand-value.js":8}],5:[function(e,t,s){"use strict";t.exports=function(e){return"\nAt line "+String(e.number+1)+": '"+e.text+"'"}},{}],6:[function(e,t,s){"use strict";t.exports={halt:{base:0,params:[]},"int":{base:16,params:[{types:["constant"],typeTo:null,valueTo:[0,8]}]},cmp:{base:32,params:[{types:["register"],typeTo:null,valueTo:[10,2]},{types:["register","constant"],typeTo:[8,2],valueTo:[0,8]}]},jmp:{base:49,params:[{types:["constant"],typeTo:null,valueTo:[0,8]}]},call:{base:65,params:[{types:["constant"],typeTo:null,valueTo:[0,8]}]},ret:{base:80,params:[]},jz:{base:96,params:[{types:["constant"],typeTo:null,valueTo:[0,8]}]},jnz:{base:97,params:[{types:["constant"],typeTo:null,valueTo:[0,8]}]},jc:{base:98,params:[{types:["constant"],typeTo:null,valueTo:[0,8]}]},jnc:{base:99,params:[{types:["constant"],typeTo:null,valueTo:[0,8]}]},ld:{base:112,params:[{types:["register"],typeTo:null,valueTo:[10,2]},{types:["register","constant","address","relative"],typeTo:[8,2],valueTo:[0,8]}]},st:{base:128,params:[{types:["register"],typeTo:null,valueTo:[10,2]},{types:["address","relative"],typeTo:[8,2],valueTo:[0,8]}]},add:{base:144,params:[{types:["register"],typeTo:null,valueTo:[10,2]},{types:["register","constant"],typeTo:[8,2],valueTo:[0,8]}]},sub:{base:160,params:[{types:["register"],typeTo:null,valueTo:[10,2]},{types:["register","constant"],typeTo:[8,2],valueTo:[0,8]}]},and:{base:176,params:[{types:["register"],typeTo:null,valueTo:[10,2]},{types:["register","constant"],typeTo:[8,2],valueTo:[0,8]}]},or:{base:192,params:[{types:["register"],typeTo:null,valueTo:[10,2]},{types:["register","constant"],typeTo:[8,2],valueTo:[0,8]}]},xor:{base:208,params:[{types:["register"],typeTo:null,valueTo:[10,2]},{types:["register","constant"],typeTo:[8,2],valueTo:[0,8]}]},inc:{base:224,params:[{types:["register"],typeTo:null,valueTo:[0,2]}]},dec:{base:225,params:[{types:["register"],typeTo:null,valueTo:[0,2]}]},not:{base:226,params:[{types:["register"],typeTo:null,valueTo:[0,2]}]},asl:{base:227,params:[{types:["register"],typeTo:null,valueTo:[0,2]}]},asr:{base:228,params:[{types:["register"],typeTo:null,valueTo:[0,2]}]},push:{base:240,params:[{types:["register"],typeTo:null,valueTo:[10,2]}]},pop:{base:241,params:[{types:["register"],typeTo:null,valueTo:[10,2]}]}}},{}],7:[function(e,t,s){"use strict";t.exports=function(e){var t;switch(e[0]){case"r":t=null===e[1].match(/[0-9]/)?"label":"register";break;case"#":t="constant";break;case"@":t="r"===e[1]?"relative":"address";break;default:t="label"}return t}},{}],8:[function(e,t,s){"use strict";var r=e("./operand-type.js");t.exports=function(e){var t;switch(r(e)){case"register":case"constant":case"address":t=e.slice(1);break;case"relative":t=e.slice(2)}return parseInt(t,16)}},{"./operand-type.js":7}],9:[function(e,t,s){t.exports=function(){var e=function(e){this._context=e||null,this._events={}};return e.prototype.on=function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},e.prototype.off=function(e,t,s){var r;if(this._events[e]){for(;-1!==(r=this._events[e].indexOf(t))&&(this._events[e].splice(r,1),s););0===this._events[e].length&&delete this._events[e]}},e.prototype.trigger=function(e,t){var s=this;s._events[e]&&s._events[e].forEach(function(e){e.apply(s._context,t||[])})},e.prototype.triggerAll=function(e){var t=this;Object.keys(t._events).forEach(function(s){t.trigger(s,e)})},e}()},{}],10:[function(e,t,s){"use strict";t.exports=function(e){e.addInterrupt(32,function(e){this.writeRegister(0,Math.floor(255*Math.random())),e()})}},{}],11:[function(e,t,s){"use strict";t.exports=function(e,t){return{value:t&Math.pow(2,e)-1,carry:t>>e===0?0:1}}},{}],12:[function(e,t,s){"use strict";function r(){this.events=new n,this.Ram=new Array(256),this.registers=new Array(4),this.bits={z:0,c:0},this.interrupts=new Array(256),i(this)}var i=e("./add-system-interrupts.js"),a=e("./util/limit.js"),n=e("reeal"),o=0,p=1,u=2,c=3,l=4,h=5,g=6,v=0,f=1,y=2,m=3,b=7,d=8,T=9,w=10,j=11,k=12,R=13,S=14,x=0,I=1,B=2,E=3,_=4,L=15,M=0,C=1,z=0,H=1,q=2,A=3;r.prototype.reset=function(){this.halted=!1,this.interrupted=!1,this.writeIp(0),this.writeSp(223),this.writeZBit(0),this.writeCBit(0);for(var e=0,t=this.Ram.length;t>e;e++)this.writeRam(e,0);for(var e=0,t=this.registers.length;t>e;e++)this.writeRegister(e,0)},r.prototype.writeRam=function(e,t){var s=a(8,t);this.Ram[e]=s.value,this.events.trigger("updateRam",[e,s.value]),this.events.trigger("updateRam:"+String(e),[e,s.value])},r.prototype.writeRegister=function(e,t){var s=a(8,t);this.registers[e]=s.value,this.writeCBit(s.carry),this.events.trigger("updateRegister",[e,s.value]),this.events.trigger("updateRegister:"+String(e),[e,s.value])},r.prototype.writeIp=function(e){var t=a(8,e);this.ip=t.value,this.events.trigger("updateInstructionPointer",[t.value])},r.prototype.writeSp=function(e){var t=a(8,e);this.sp=t.value,this.events.trigger("updateStackPointer",[t.value])},r.prototype.writeZBit=function(e){this.bits.z=e,this.events.trigger("updateZBit",[e])},r.prototype.writeCBit=function(e){this.bits.c=e,this.events.trigger("updateCBit",[e])},r.prototype.addInterrupt=function(e,t){this.interrupts[e]=t},r.prototype.step=function(){function e(){switch(P){case z:s=i.registers[N];break;case H:s=n;break;case q:s=i.Ram[n];break;case A:s=i.Ram[i.registers[N]]}}function t(){switch(P){case q:r=n;break;case A:r=i.registers[N]}}var s,r,i=this,a=this.Ram[this.ip],n=this.Ram[this.ip+1],Z=(12&a)>>2,P=3&a,N=3&n;if(!this.halted&&!this.interrupted)switch(this.writeIp(this.ip+2),a>>4){case o:this.halted=!0;break;case p:"function"==typeof this.interrupts[n]&&(this.interrupted=!0,this.interrupts[n].call(this,function(){this.interrupted=!1}.bind(this)));break;case u:e(),this.registers[Z]===s?this.writeZBit(1):this.writeZBit(0);break;case c:this.writeIp(n);break;case l:e(),this.writeRam(this.sp,this.ip),this.writeSp(this.sp-1),this.writeIp(s);break;case h:this.writeSp(this.sp+1),this.writeIp(this.Ram[this.sp]);break;case g:switch(3&a){case v:1===this.bits.z&&this.writeIp(n);break;case f:0===this.bits.z&&this.writeIp(n);break;case y:1===this.bits.c&&this.writeIp(n);break;case m:0===this.bits.c&&this.writeIp(n)}break;case b:e(),this.writeRegister(Z,s);break;case d:t(),this.writeRam(r,this.registers[Z]);break;case T:e(),this.writeRegister(Z,this.registers[Z]+s);break;case w:e(),this.writeRegister(Z,this.registers[Z]-s);break;case j:e(),this.writeRegister(Z,this.registers[Z]&s);break;case k:e(),this.writeRegister(Z,this.registers[Z]|s);break;case R:e(),this.writeRegister(Z,this.registers[Z]^s);break;case S:switch(7&a){case x:this.writeRegister(N,this.registers[N]+1);break;case I:this.writeRegister(N,this.registers[N]-1);break;case B:this.writeRegister(N,~this.registers[N]);break;case E:this.writeRegister(N,this.registers[N]<<1);break;case _:this.writeRegister(N,this.registers[N]>>1)}break;case L:switch(1&a){case M:this.writeRam(this.sp,this.registers[Z]),this.writeSp(this.sp-1);break;case C:this.writeSp(this.sp+1),this.writeRegister(Z,this.Ram[this.sp])}}this.events.trigger("step")},t.exports=r},{"./add-system-interrupts.js":10,"./util/limit.js":11,reeal:9}]},{},[1]);